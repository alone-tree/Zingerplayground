{{ define "title" }}{{ .Site.Title }}{{ end }}
{{ define "main" }}
<div class="container">
  <section class="home-section">
    <h2>最新小说</h2>
    <div class="novels-list">
      {{/* 获取所有小说页面（排除 _index.md 等 section 页面） */}}
      {{ $novels := where .Site.RegularPages "Section" "novels" }}
      {{ $novels = where $novels "Kind" "page" }}
      {{ $uniqueNovels := slice }}
      {{ $seenNovels := slice }}
      
      {{/* 获取最新更新的 2 部小说 */}}
      {{ range $novels.ByLastmod.Reverse }}
        {{ $novelName := .Params.novel | default .Title }}
        {{ if not (in $seenNovels $novelName) }}
          {{ $uniqueNovels = $uniqueNovels | append . }}
          {{ $seenNovels = $seenNovels | append $novelName }}
        {{ end }}
        {{ if ge (len $uniqueNovels) 2 }}
          {{ break }}
        {{ end }}
      {{ end }}
      
      {{ range $uniqueNovels }}
        <article class="novel-item">
          <h3><a href="{{ .RelPermalink }}">{{ .Params.novel | default .Title }}</a></h3>
          <div class="novel-meta">
            <span class="novel-chapter">
              {{ if .Params.chapter }}第{{ .Params.chapter }}章: {{ end }}{{ .Title }}
            </span>
            <span class="novel-date">{{ .Lastmod.Format "2006-01-02" }}</span>
            {{ if .Params.tags }}
              <span class="novel-tags">
                {{ range .Params.tags }}
                  <span class="tag">{{ . }}</span>
                {{ end }}
              </span>
            {{ end }}
          </div>
        </article>
      {{ end }}
    </div>
    
    <div class="view-more">
      <a href="/novels/" class="btn">查看所有小说 →</a>
    </div>
  </section>
</div>

<style>
.home-section {
  padding: var(--spacing-lg) 0;
}

.home-section h2 {
  font-size: 2rem;
  margin-bottom: var(--spacing-md);
  color: var(--text-color);
}

.novels-list {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.novel-item {
  padding: var(--spacing-md);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  transition: box-shadow var(--transition);
}

.novel-item:hover {
  box-shadow: 0 4px 12px var(--shadow-color);
}

.novel-item h3 {
  margin-bottom: var(--spacing-sm);
}

.novel-item h3 a {
  color: var(--text-color);
}

.novel-meta {
  display: flex;
  gap: var(--spacing-sm);
  flex-wrap: wrap;
  font-size: 0.9rem;
  color: var(--text-color);
  opacity: 0.7;
}

.novel-tags {
  display: flex;
  gap: var(--spacing-xs);
}

.tag {
  background-color: rgba(162, 123, 92, 0.2);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.85rem;
}

.view-more {
  margin-top: var(--spacing-lg);
  text-align: center;
}

.btn {
  display: inline-block;
  padding: var(--spacing-sm) var(--spacing-md);
  background-color: var(--link-color);
  color: white;
  border-radius: 4px;
  transition: background-color var(--transition);
}

.btn:hover {
  background-color: var(--link-hover);
  color: white;
}
</style>
{{ end }}
